/* -----------------------
 * iFrame Auto Size Script
 * -----------------------
 * This script is used to create auto sizing iFrames, even if they are served from a different domain.
 * NB: This script needs to be loaded into the parent page AND the embedded page so you need access to include the script on the iFrame domain
 *
 * Usage: http://scripts.deependmelbourne.com.au/iFrameAutoSize.html
 * 
 * Author: Rick Lannan, Deepend
 * Version: 1.2
 * References: http://stackoverflow.com/questions/153152/resizing-an-iframe-based-on-content
 * Copyright (C): Rick Lannan, 2013 
 * Distibution & Modification: GNU License, please give credit
 */
if(!iFrameAutoSize)var iFrameAutoSize={iFrameSettings:null,create:function(e){function t(){i.adjustWidth&&(o.adjustWidth=i.adjustWidth),o.iFrame=document.getElementById("iFrameAutoSize-"+i.domId),i.onResize&&(o.onResize=i.onResize),o.iFrame||(o.iFrame=document.createElement("IFRAME"),o.iFrame.setAttribute("style",i.additionalCSS),o.iFrame.style.width=i.initialWidth,o.iFrame.style.height=i.initialHeight,o.iFrame.style.border=0,o.iFrame.setAttribute("frameborder",0),o.iFrame.setAttribute("frameBorder",0),o.iFrame.setAttribute("border",0),o.iFrame.setAttribute("cellspacing",0),o.iFrame.setAttribute("marginwidth",0),o.iFrame.setAttribute("marginheight",0),o.iFrame.setAttribute("scrolling","no"),o.iFrame.setAttribute("id","iFrameAutoSize-"+i.domId),o.iFrame.setAttribute("class","iFrameAutoSize-iFrame"),r.appendChild(o.iFrame)),o.iFrame.setAttribute("src",i.iFrameUrl+(-1==i.iFrameUrl.indexOf("?")?"?":"&")+(i.resizeHelperUrl?"helperUrl="+encodeURIComponent(i.resizeHelperUrl):"")+"&parentDomId="+i.domId+"&pageLoading=true")}var i={domId:"undefined"!=typeof e&&"undefined"!=typeof e.domId?e.domId:"",iFrameUrl:"undefined"!=typeof e&&"undefined"!=typeof e.iFrameUrl?e.iFrameUrl:"",resizeHelperUrl:"undefined"!=typeof e&&"undefined"!=typeof e.resizeHelperUrl?e.resizeHelperUrl:"",loaderUrl:"undefined"!=typeof e&&"undefined"!=typeof e.loaderUrl?e.loaderUrl:"",waitForPageLoad:"undefined"!=typeof e&&"undefined"!=typeof e.waitForPageLoad?e.waitForPageLoad:!1,adjustWidth:"undefined"!=typeof e&&"undefined"!=typeof e.adjustWidth?e.adjustWidth:!1,initialWidth:"undefined"!=typeof e&&"undefined"!=typeof e.initialWidth?e.initialWidth:"100%",initialHeight:"undefined"!=typeof e&&"undefined"!=typeof e.initialHeight?e.initialHeight:"0px",minHeight:"undefined"!=typeof e&&"undefined"!=typeof e.minHeight?e.minHeight.replace(/ ?px/,""):0,scrollOnResize:"undefined"!=typeof e&&"undefined"!=typeof e.scrollOnResize?e.scrollOnResize:!0,additionalCSS:"undefined"!=typeof e&&"undefined"!=typeof e.additionalCSS?e.additionalCSS:"",loaderCSS:"undefined"!=typeof e&&"undefined"!=typeof e.loaderCSS?e.loaderCSS:"",onResize:"undefined"!=typeof e&&"undefined"!=typeof e.onResize?e.onResize:null};if(i.domId&&i.iFrameUrl&&i.resizeHelperUrl){i.resizeHelperUrl=i.resizeHelperUrl.replace(/^(https?:)?\/\//i,window.location.protocol+"//"),0==i.resizeHelperUrl.indexOf("/")&&(i.resizeHelperUrl=window.location.protocol+"//"+window.location.host+i.resizeHelperUrl),0!=i.resizeHelperUrl.indexOf("http")&&(i.resizeHelperUrl=window.location.href.replace(/[^\/]*$/,"")+i.resizeHelperUrl);var r=document.getElementById(i.domId);if(r){iFrameAutoSize.iFrameSettings||(iFrameAutoSize.iFrameSettings=new Array),iFrameAutoSize.iFrameSettings[i.domId]={domElem:r,iFrame:null,loader:null,adjustWidth:!1,onResize:null,connectionId:"",messageNum:0,minHeight:i.minHeight,scrollOnResize:i.scrollOnResize,pageLoaded:!1};var o=iFrameAutoSize.iFrameSettings[i.domId];i.loaderUrl&&(o.loader=document.createElement("IMG"),o.loader.setAttribute("src",i.loaderUrl),o.loader.setAttribute("style","display: block; margin: 0 auto; "+i.loaderCSS),o.loader.setAttribute("id","iFrameAutoSize-"+i.domId+"-loader"),o.loader.setAttribute("class","iFrameAutoSize-loader"),r.appendChild(o.loader)),i.waitForPageLoad?iFrameAutoSize.helpers.addDomEvent(window,"load",t):t()}}},forceParentFrame:function(e){var t={parentUrl:"undefined"!=typeof e&&"undefined"!=typeof e.parentUrl?e.parentUrl:""};t.parentUrl&&window.self===window.top&&(window.location.href=t.parentUrl+(-1==t.parentUrl.indexOf("?")?"?":"&")+"frameUrl="+encodeURIComponent(window.location.href))},resize:function(e){function t(){var e=iFrameAutoSize.helpers.getPageDimensions();if(i.domId&&document.getElementById(i.domId))e=iFrameAutoSize.helpers.getDimensions(document.getElementById(i.domId));else{var r=document.getElementsByTagName("div")[0];if(r){var o=iFrameAutoSize.helpers.getDimensions(r);o.height>e.height&&(e.height=o.height),o.width>e.width&&(e.width=o.width)}}iFrameAutoSize.iFrameSettings||(iFrameAutoSize.iFrameSettings=new Array),iFrameAutoSize.iFrameSettings[i.parentDomId]||(iFrameAutoSize.iFrameSettings[i.parentDomId]={currHeight:0,currWidth:0,frameLoaded:!1,messageNum:1,connectionId:encodeURIComponent(window.location.href),pageLoading:window.location.href.match(/&pageLoading=true$/)?"true":"false"});var n=iFrameAutoSize.iFrameSettings[i.parentDomId];(e.height!=n.currHeight||e.width!=n.currWidth||n.lastUrl&&n.lastUrl!=window.location.href)&&(n.currWidth=e.width,n.currHeight=n.frameLoaded?e.height:0,n.lastUrl&&n.lastUrl!=window.location.href&&(n.connectionId=encodeURIComponent(window.location.href),n.messageNum=1),n.lastUrl=window.location.href,n.frameLoaded&&0==n.currHeight||(pipe=document.createElement("IFRAME"),pipe.style.width=0,pipe.style.height=0,pipe.setAttribute("frameborder",0),pipe.setAttribute("id","iFrameAutoSizePipe"),pipe.setAttribute("visibility","hidden"),pipe.setAttribute("src",i.resizeHelperUrl+"?connectionId="+n.connectionId+"&messageNum="+n.messageNum+"&domId="+i.parentDomId+"&height="+n.currHeight+"&width="+n.currWidth+"&pageLoading="+n.pageLoading),document.body.appendChild(pipe),n.messageNum+=1),n.frameLoaded=!0),i.resizeOnLoadOnly&&n.frameLoaded||(iFrameAutoSize.resizeInterval=setTimeout(t,100))}var i={resizeHelperUrl:"undefined"!=typeof e&&"undefined"!=typeof e.resizeHelperUrl?e.resizeHelperUrl:"",domId:"undefined"!=typeof e&&"undefined"!=typeof e.domId?e.domId:"",parentDomId:"undefined"!=typeof e&&"undefined"!=typeof e.parentDomId?e.parentDomId:"",resizeOnLoadOnly:"undefined"!=typeof e&&"undefined"!=typeof e.resizeOnLoadOnly?e.resizeOnLoadOnly:!1,waitForPageLoad:"undefined"!=typeof e&&"undefined"!=typeof e.waitForPageLoad?e.waitForPageLoad:!1,useCookie:"undefined"!=typeof e&&"undefined"!=typeof e.useCookie?e.useCookie:!0};i.resizeHelperUrl||(i.resizeHelperUrl=decodeURIComponent(iFrameAutoSize.helpers.getQueryStringParam(window.location.search,"helperUrl"))),i.useCookie&&!i.resizeHelperUrl&&(i.resizeHelperUrl=iFrameAutoSize.helpers.getCookie("iFrameAutoSize_helperUrl")),i.parentDomId||(i.parentDomId=decodeURIComponent(iFrameAutoSize.helpers.getQueryStringParam(window.location.search,"parentDomId"))),i.resizeHelperUrl&&(i.useCookie&&iFrameAutoSize.helpers.setCookie("iFrameAutoSize_helperUrl",i.resizeHelperUrl),i.waitForPageLoad?iFrameAutoSize.helpers.addDomEvent(window,"load",t()):t())},helpers:{resizeIFrame:function(e,t,i,r,o,n){var a=iFrameAutoSize.iFrameSettings[i],d=parseInt(t);if(!a){var l=-1;for(var m in iFrameAutoSize.iFrameSettings)if("string"==typeof m&&(m=iFrameAutoSize.iFrameSettings[m]),m.iFrame){m.domElem.className=m.domElem.className.replace(/ iframe-active/,"");var s=iFrameAutoSize.helpers.getPercentageOfFrameVisible(m.iFrame);s>l&&(a=m,l=s)}a.domElem.className=a.domElem.className+" iframe-active"}if(a&&a.iFrame&&(a.connectionId!=e&&(a.connectionId=e,a.messageNum=0),a.messageNum<d)){var u=a.pageLoaded||!n;if(a.messageNum=d,o>0&&(a.domElem.style.height=parseInt(Math.max(a.minHeight,o))+"px"),a.iFrame.style.height=parseInt(Math.max(a.minHeight,o))+"px",a.iFrame.style.width=a.adjustWidth?parseInt(r)+"px":"100%","function"==typeof a.onResize&&a.onResize.call(a.iFrame,u),u&&a.scrollOnResize){a.pageLoaded=!0;var p=iFrameAutoSize.helpers.getPageOffset(a.iFrame).top;document.body.scrollTop?document.body.scrollTop=p:document.documentElement.scrollTop&&(document.documentElement.scrollTop=p)}a.loader&&o>1&&(a.loader.style.display="none")}},getPercentageOfFrameVisible:function(e){var t=iFrameAutoSize.helpers.getDimensions(e),i=iFrameAutoSize.helpers.getPageOffset(e),r=iFrameAutoSize.helpers.getScrollPosition(),o=r.top-i.top<0?0:r.top-i.top,n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;o+=i.top+t.height-o-(r.top+a)<0?0:i.top+t.height-o-(r.top+a);var d=r.left-i.left<0?0:r.left-i.left;d+=i.left+t.width-d-(r.left+n)<0?0:i.left+t.width-d-(r.left+n);var l=0!=t.height?(t.height-o)/t.height*100:1,m=0!=t.width?(t.width-d)/t.width*100:1,s=Math.min(l,m);return 0>s?0:s},addDomEvent:function(e,t,i){null!=e&&void 0!=e&&(e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i)},getPageDimensions:function(){var e=document;return{width:Math.max(Math.max(e.body.scrollWidth,e.documentElement.scrollWidth),Math.max(e.body.offsetWidth,e.documentElement.offsetWidth),Math.max(e.body.clientWidth,e.documentElement.clientWidth)),height:Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))}},getScrollPosition:function(){var e=document;return{top:Math.max(e.body.scrollTop,e.documentElement.scrollTop),left:Math.max(e.body.scrollLeft,e.documentElement.scrollLeft)}},getDimensions:function(e){return e?{width:Math.max(Math.max(e.scrollWidth,e.offsetWidth),e.clientWidth),height:Math.max(Math.max(e.scrollHeight,e.offsetHeight),e.clientHeight)}:iFrameAutoSize.helpers.getPageDimensions()},getPageOffset:function(e){var t=0,i=0;return!e||isNaN(e.offsetLeft)||isNaN(e.offsetTop)||(t+=e.offsetLeft-e.scrollLeft,i+=e.offsetTop-e.scrollTop,e=e.offsetParent),{top:i,left:t}},setCookie:function(e,t){document.cookie=e+"="+escape(t)+"; path=/"},getCookie:function(e){e=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");var t="(^|[;,\\s])"+e+"\\s?=\\s?([^;,\\s]*)",i=new RegExp(t),r=i.exec(document.cookie);return null==r?"":unescape(r[2])},getQueryStringParam:function(e,t){t=t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");var i="[\\?&]"+t+"=([^&#]*)",r=new RegExp(i),o=r.exec(e);return null==o?"":o[1]}}};