/* -----------------------
 * iFrame Auto Size Script
 * -----------------------
 * This script is used to create auto sizing iFrames, even if they are served from a different domain.
 * NB: This script needs to be loaded into the parent page AND the embedded page so you need access to include the script on the iFrame domain
 *
 * Usage: http://scripts.deependmelbourne.com.au/iFrameAutoSize.html
 * 
 * Author: Rick Lannan, Deepend
 * Version: 1.1
 * References: http://stackoverflow.com/questions/153152/resizing-an-iframe-based-on-content
 * Copyright (C): Rick Lannan, 2013 
 * Distibution & Modification: GNU License, please give credit
 */
if(!iFrameAutoSize){var iFrameAutoSize={iFrameSettings:null,create:function(e){var t={domId:typeof e!="undefined"&&typeof e.domId!="undefined"?e.domId:"",iFrameUrl:typeof e!="undefined"&&typeof e.iFrameUrl!="undefined"?e.iFrameUrl:"",resizeHelperUrl:typeof e!="undefined"&&typeof e.resizeHelperUrl!="undefined"?e.resizeHelperUrl:"",loaderUrl:typeof e!="undefined"&&typeof e.loaderUrl!="undefined"?e.loaderUrl:"",waitForPageLoad:typeof e!="undefined"&&typeof e.waitForPageLoad!="undefined"?e.waitForPageLoad:false,adjustWidth:typeof e!="undefined"&&typeof e.adjustWidth!="undefined"?e.adjustWidth:false,initialWidth:typeof e!="undefined"&&typeof e.initialWidth!="undefined"?e.initialWidth:"100%",initialHeight:typeof e!="undefined"&&typeof e.initialHeight!="undefined"?e.initialHeight:"0px",minHeight:typeof e!="undefined"&&typeof e.minHeight!="undefined"?e.minHeight.replace(/ ?px/,""):0,scrollOnResize:typeof e!="undefined"&&typeof e.scrollOnResize!="undefined"?e.scrollOnResize:true,additionalCSS:typeof e!="undefined"&&typeof e.additionalCSS!="undefined"?e.additionalCSS:"",loaderCSS:typeof e!="undefined"&&typeof e.loaderCSS!="undefined"?e.loaderCSS:"",onResize:typeof e!="undefined"&&typeof e.onResize!="undefined"?e.onResize:null};if(t.domId&&t.iFrameUrl&&t.resizeHelperUrl){t.resizeHelperUrl=t.resizeHelperUrl.replace(/^(https?:)?\/\//i,window.location.protocol+"//");if(t.resizeHelperUrl.indexOf("/")==0)t.resizeHelperUrl=window.location.protocol+"//"+window.location.host+t.resizeHelperUrl;if(t.resizeHelperUrl.indexOf("http")!=0)t.resizeHelperUrl=window.location.href.replace(/[^\/]*$/,"")+t.resizeHelperUrl;var n=document.getElementById(t.domId);if(n){if(!iFrameAutoSize.iFrameSettings)iFrameAutoSize.iFrameSettings=new Array;iFrameAutoSize.iFrameSettings[t.domId]={domElem:n,iFrame:null,loader:null,adjustWidth:false,onResize:null,connectionId:"",messageNum:0,minHeight:t.minHeight,scrollOnResize:t.scrollOnResize,pageLoaded:false};var r=iFrameAutoSize.iFrameSettings[t.domId];function i(){if(t.adjustWidth)r.adjustWidth=t.adjustWidth;r.iFrame=document.getElementById("iFrameAutoSize-"+t.domId);if(t.onResize)r.onResize=t.onResize;if(!r.iFrame){r.iFrame=document.createElement("IFRAME");r.iFrame.setAttribute("style",t.additionalCSS);r.iFrame.style.width=t.initialWidth;r.iFrame.style.height=t.initialHeight;r.iFrame.style.border=0;r.iFrame.setAttribute("frameborder",0);r.iFrame.setAttribute("frameBorder",0);r.iFrame.setAttribute("border",0);r.iFrame.setAttribute("cellspacing",0);r.iFrame.setAttribute("marginwidth",0);r.iFrame.setAttribute("marginheight",0);r.iFrame.setAttribute("scrolling","no");r.iFrame.setAttribute("id","iFrameAutoSize-"+t.domId);r.iFrame.setAttribute("class","iFrameAutoSize-iFrame");n.appendChild(r.iFrame)}r.iFrame.setAttribute("src",t.iFrameUrl+(t.iFrameUrl.indexOf("?")==-1?"?":"&")+(t.resizeHelperUrl?"helperUrl="+encodeURIComponent(t.resizeHelperUrl):"")+"&parentDomId="+t.domId+"&pageLoading=true")}if(t.loaderUrl){r.loader=document.createElement("IMG");r.loader.setAttribute("src",t.loaderUrl);r.loader.setAttribute("style","display: block; margin: 0 auto; "+t.loaderCSS);r.loader.setAttribute("id","iFrameAutoSize-"+t.domId+"-loader");r.loader.setAttribute("class","iFrameAutoSize-loader");n.appendChild(r.loader)}if(t.waitForPageLoad){iFrameAutoSize.helpers.addDomEvent(window,"load",i)}else{i()}}}},forceParentFrame:function(e){var t={parentUrl:typeof e!="undefined"&&typeof e.parentUrl!="undefined"?e.parentUrl:""};if(t.parentUrl&&window.self===window.top){window.location.href=t.parentUrl+(t.parentUrl.indexOf("?")==-1?"?":"&")+"frameUrl="+encodeURIComponent(window.location.href)}},resize:function(e){var t={resizeHelperUrl:typeof e!="undefined"&&typeof e.resizeHelperUrl!="undefined"?e.resizeHelperUrl:"",domId:typeof e!="undefined"&&typeof e.domId!="undefined"?e.domId:"",parentDomId:typeof e!="undefined"&&typeof e.parentDomId!="undefined"?e.parentDomId:"",resizeOnLoadOnly:typeof e!="undefined"&&typeof e.resizeOnLoadOnly!="undefined"?e.resizeOnLoadOnly:false,waitForPageLoad:typeof e!="undefined"&&typeof e.waitForPageLoad!="undefined"?e.waitForPageLoad:false,useCookie:typeof e!="undefined"&&typeof e.useCookie!="undefined"?e.useCookie:true};if(!t.resizeHelperUrl){t.resizeHelperUrl=decodeURIComponent(iFrameAutoSize.helpers.getQueryStringParam(window.location.search,"helperUrl"))}if(t.useCookie&&!t.resizeHelperUrl){t.resizeHelperUrl=iFrameAutoSize.helpers.getCookie("iFrameAutoSize_helperUrl")}if(!t.parentDomId){t.parentDomId=decodeURIComponent(iFrameAutoSize.helpers.getQueryStringParam(window.location.search,"parentDomId"))}if(t.resizeHelperUrl){if(t.useCookie){iFrameAutoSize.helpers.setCookie("iFrameAutoSize_helperUrl",t.resizeHelperUrl)}function n(){var e=iFrameAutoSize.helpers.getPageDimensions();if(t.domId){e=iFrameAutoSize.helpers.getDimensions(document.getElementById(t.domId))}else{var r=document.getElementsByTagName("div")[0];if(r){var i=iFrameAutoSize.helpers.getDimensions(r);if(i.height>e.height)e.height=i.height;if(i.width>e.width)e.width=i.width}}if(!iFrameAutoSize.iFrameSettings)iFrameAutoSize.iFrameSettings=new Array;if(!iFrameAutoSize.iFrameSettings[t.parentDomId]){iFrameAutoSize.iFrameSettings[t.parentDomId]={currHeight:0,currWidth:0,frameLoaded:false,messageNum:1,connectionId:encodeURIComponent(window.location.href),pageLoading:window.location.href.match(/&pageLoading=true$/)?"true":"false"}}var s=iFrameAutoSize.iFrameSettings[t.parentDomId];if(e.height!=s.currHeight||e.width!=s.currWidth||s.lastUrl&&s.lastUrl!=window.location.href){s.currWidth=e.width;s.currHeight=s.frameLoaded?e.height:0;if(s.lastUrl&&s.lastUrl!=window.location.href){s.connectionId=encodeURIComponent(window.location.href);s.messageNum=1}s.lastUrl=window.location.href;if(!s.frameLoaded||s.currHeight!=0){pipe=document.createElement("IFRAME");pipe.style.width=0;pipe.style.height=0;pipe.setAttribute("frameborder",0);pipe.setAttribute("id","iFrameAutoSizePipe");pipe.setAttribute("visibility","hidden");pipe.setAttribute("src",t.resizeHelperUrl+"?connectionId="+s.connectionId+"&messageNum="+s.messageNum+"&domId="+t.parentDomId+"&height="+s.currHeight+"&width="+s.currWidth+"&pageLoading="+s.pageLoading);document.body.appendChild(pipe);s.messageNum+=1}s.frameLoaded=true}if(!t.resizeOnLoadOnly||!s.frameLoaded)iFrameAutoSize.resizeInterval=setTimeout(n,100)}if(t.waitForPageLoad){iFrameAutoSize.helpers.addDomEvent(window,"load",n())}else{n()}}},helpers:{resizeIFrame:function(e,t,n,r,i,s){var o=iFrameAutoSize.iFrameSettings[n];if(!o){var u=-1;for(var a in iFrameAutoSize.iFrameSettings){if(typeof a=="string")a=iFrameAutoSize.iFrameSettings[a];if(a.iFrame){a.domElem.className=a.domElem.className.replace(/ iframe-active/,"");var f=iFrameAutoSize.helpers.getPercentageOfFrameVisible(a.iFrame);if(f>u){o=a;u=f}}}o.domElem.className=o.domElem.className+" iframe-active"}if(o&&o.iFrame){if(o.connectionId!=e){o.connectionId=e;o.messageNum=0}if(o.messageNum<t){var l=o.pageLoaded||!s;o.messageNum=t;if(i>0){o.domElem.style.height=parseInt(Math.max(settings.minHeight,i))+"px"}o.iFrame.style.height=parseInt(Math.max(settings.minHeight,i))+"px";if(o.adjustWidth){o.iFrame.style.width=parseInt(r)+"px"}else{o.iFrame.style.width="100%"}if(typeof o.onResize=="function"){o.onResize.call(o.iFrame,l)}if(l&&o.scrollOnResize){o.pageLoaded=true;var c=iFrameAutoSize.helpers.getPageOffset(o.iFrame).top;if(document.body.scrollTop){document.body.scrollTop=c}else if(document.documentElement.scrollTop){document.documentElement.scrollTop=c}}if(o.loader&&i>1){o.loader.style.display="none"}}}},getPercentageOfFrameVisible:function(e){var t=iFrameAutoSize.helpers.getDimensions(e);var n=iFrameAutoSize.helpers.getPageOffset(e);var r=iFrameAutoSize.helpers.getScrollPosition();var i=r.top-n.top<0?0:r.top-n.top;i+=n.top+t.height-i-(r.top+window.innerHeight)<0?0:n.top+t.height-i-(r.top+window.innerHeight);var s=r.left-n.left<0?0:r.left-n.left;s+=n.left+t.width-s-(r.left+window.innerWidth)<0?0:n.left+t.width-s-(r.left+window.innerWidth);var o=t.height!=0?(t.height-i)/t.height*100:1;var u=t.width!=0?(t.width-s)/t.width*100:1;var a=Math.min(o,u);return a<0?0:a},addDomEvent:function(e,t,n){if(e==null||e==undefined)return;if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){e.attachEvent("on"+t,n)}else{e["on"+t]=n}},getPageDimensions:function(){var e=document;return{width:Math.max(Math.max(e.body.scrollWidth,e.documentElement.scrollWidth),Math.max(e.body.offsetWidth,e.documentElement.offsetWidth),Math.max(e.body.clientWidth,e.documentElement.clientWidth)),height:Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))}},getScrollPosition:function(){var e=document;return{top:Math.max(e.body.scrollTop,e.documentElement.scrollTop),left:Math.max(e.body.scrollLeft,e.documentElement.scrollLeft)}},getDimensions:function(e){if(e){return{width:Math.max(Math.max(e.scrollWidth,e.offsetWidth),e.clientWidth),height:Math.max(Math.max(e.scrollHeight,e.offsetHeight),e.clientHeight)}}else{return iFrameAutoSize.helpers.getPageDimensions()}},getPageOffset:function(e){var t=0;var n=0;if(e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop)){t+=e.offsetLeft-e.scrollLeft;n+=e.offsetTop-e.scrollTop;e=e.offsetParent}return{top:n,left:t}},setCookie:function(e,t){document.cookie=e+"="+escape(t)+"; path=/"},getCookie:function(e){e=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");var t="(^|[;,\\s])"+e+"\\s?=\\s?([^;,\\s]*)";var n=new RegExp(t);var r=n.exec(document.cookie);if(r==null){return""}else{return unescape(r[2])}},getQueryStringParam:function(e,t){t=t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");var n="[\\?&]"+t+"=([^&#]*)";var r=new RegExp(n);var i=r.exec(e);if(i==null){return""}else{return i[1]}}}}};